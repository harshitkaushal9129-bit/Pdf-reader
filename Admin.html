<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Admin | PDF Vault Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <style>
        body { font-family: 'Poppins', sans-serif; }
        .user-row:hover { background: rgba(56, 189, 248, 0.05); }
        .glass-card { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #38bdf8; border-radius: 10px; }
    </style>
</head>
<body class="bg-[#0f172a] text-white min-h-screen pb-10">

    <nav class="bg-slate-900/80 sticky top-0 z-50 border-b border-white/5 p-5 backdrop-blur-md">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-black text-sky-400 italic">ADMIN <span class="text-white font-normal">CONTROL</span></h1>
            </div>
            <div class="bg-sky-500/10 border border-sky-500/20 px-5 py-2 rounded-full">
                <span id="user-count" class="font-black text-sky-400">0</span> <span class="text-[10px] uppercase font-bold ml-1 text-slate-400">Users Active</span>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto p-4 md:p-8 grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <div class="lg:col-span-2 space-y-6">
            <div class="relative">
                <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-500"></i>
                <input type="text" id="adminSearch" onkeyup="filterUsers()" placeholder="Search by email or UID..." class="w-full bg-slate-800/50 border border-white/10 rounded-2xl py-4 pl-12 pr-4 focus:outline-none focus:border-sky-500 transition-all">
            </div>

            <div class="glass-card rounded-[35px] overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-slate-900/50 border-b border-white/5">
                        <tr>
                            <th class="p-5 text-[10px] uppercase tracking-widest text-slate-400">User Details</th>
                            <th class="p-5 text-[10px] uppercase tracking-widest text-slate-400">Used / Limit</th>
                            <th class="p-5 text-center text-[10px] uppercase tracking-widest text-slate-400">Action</th>
                        </tr>
                    </thead>
                    <tbody id="admin-user-list">
                        </tbody>
                </table>
            </div>
        </div>

        <div class="lg:col-span-1">
            <div id="editor-ui" class="hidden glass-card p-8 rounded-[40px] sticky top-32 border-t-4 border-sky-500 shadow-2xl">
                <div class="text-center mb-8">
                    <div class="w-20 h-20 bg-sky-500/10 rounded-full flex items-center justify-center mx-auto mb-4 border border-sky-500/20">
                        <i class="fas fa-user-shield text-3xl text-sky-400"></i>
                    </div>
                    <h2 id="view-email" class="font-black text-lg truncate px-2 text-white">---</h2>
                    <p id="view-uid" class="text-[9px] text-slate-500 font-mono mt-1"></p>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-8">
                    <div class="bg-slate-900/50 p-4 rounded-3xl border border-white/5 text-center">
                        <span class="text-[9px] text-slate-500 uppercase block mb-1">Used Views</span>
                        <span id="view-used" class="text-2xl font-black">0</span>
                    </div>
                    <div class="bg-slate-900/50 p-4 rounded-3xl border border-white/5 text-center">
                        <span class="text-[9px] text-slate-500 uppercase block mb-1">Total Limit</span>
                        <span id="view-limit" class="text-2xl font-black text-sky-400">0</span>
                    </div>
                </div>

                <div class="space-y-4">
                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Update PDF Limit</label>
                    <div class="flex gap-2">
                        <button onclick="addLimitValue(5)" class="flex-1 bg-slate-800 hover:bg-slate-700 py-3 rounded-xl font-bold transition-all border border-white/5">+5</button>
                        <button onclick="addLimitValue(10)" class="flex-1 bg-slate-800 hover:bg-slate-700 py-3 rounded-xl font-bold transition-all border border-white/5">+10</button>
                    </div>
                    <input type="number" id="input-new-limit" class="w-full bg-slate-900 border border-slate-700 rounded-2xl py-4 text-center text-xl font-black text-sky-400 focus:outline-none focus:border-sky-500" placeholder="New Limit">
                    <button onclick="updateUserInDB()" class="w-full bg-sky-500 text-slate-900 font-black py-4 rounded-2xl shadow-xl hover:bg-sky-400 active:scale-95 transition-all uppercase tracking-tighter">Save Changes</button>
                    
                    <div class="pt-4 border-t border-white/5">
                        <button onclick="resetViewsOnly()" class="w-full bg-red-500/10 text-red-500 border border-red-500/20 py-3 rounded-xl text-[10px] font-black uppercase">Reset Used Views to 0</button>
                    </div>
                </div>
            </div>

            <div id="hint-ui" class="glass-card p-12 rounded-[40px] text-center border-2 border-dashed border-white/10 opacity-50">
                <i class="fas fa-mouse-pointer text-4xl mb-4 text-slate-600"></i>
                <p class="text-slate-500 text-sm font-medium leading-relaxed">Kisi bhi user par click karein unki details manage karne ke liye.</p>
            </div>
        </div>
    </div>

    <script>
        // --- 1. Firebase Setup ---
        const firebaseConfig = {
            apiKey: "AIzaSyAcmK0aCHIgLuFGRPm82GL-hEnLS8JjuKY",
            authDomain: "pdf-reader-650f5.firebaseapp.com",
            databaseURL: "https://pdf-reader-650f5-default-rtdb.firebaseio.com",
            projectId: "pdf-reader-650f5",
            appId: "1:163058397387:web:4cc94d2921706d1bf16b4e"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let currentActiveUid = '';

        // --- 2. Load Users List ---
        function initAdmin() {
            db.ref('students').on('value', (snap) => {
                const list = document.getElementById('admin-user-list');
                const countLabel = document.getElementById('user-count');
                list.innerHTML = '';
                
                if(!snap.exists()) {
                    list.innerHTML = '<tr><td colspan="3" class="p-10 text-center text-slate-600 italic">No users found in database.</td></tr>';
                    return;
                }

                countLabel.innerText = snap.numChildren();

                snap.forEach(child => {
                    const user = child.val();
                    const uid = child.key;
                    const email = user.email || "No Email Updated";
                    const limit = user.limit || 5;
                    const views = user.views || 0;

                    const tr = document.createElement('tr');
                    tr.className = "user-row border-b border-white/5 transition-all cursor-pointer";
                    tr.onclick = () => openUserEditor(uid, email, limit, views);
                    
                    tr.innerHTML = `
                        <td class="p-5">
                            <div class="font-bold text-white text-sm truncate max-w-[180px] md:max-w-xs">${email}</div>
                            <div class="text-[9px] text-slate-500 font-mono mt-0.5">${uid}</div>
                        </td>
                        <td class="p-5">
                            <span class="bg-slate-900/80 px-4 py-1.5 rounded-full text-[11px] font-black border border-white/5">
                                <span class="${views >= limit ? 'text-red-500' : 'text-sky-400'}">${views}</span> / <span class="text-white">${limit}</span>
                            </span>
                        </td>
                        <td class="p-5 text-center">
                            <i class="fas fa-chevron-right text-slate-700 text-xs"></i>
                        </td>
                    `;
                    list.appendChild(tr);
                });
            });
        }

        // --- 3. UI Logic ---
        function openUserEditor(uid, email, limit, views) {
            currentActiveUid = uid;
            document.getElementById('hint-ui').classList.add('hidden');
            document.getElementById('editor-ui').classList.remove('hidden');
            
            document.getElementById('view-email').innerText = email;
            document.getElementById('view-uid').innerText = "ID: " + uid;
            document.getElementById('view-used').innerText = views;
            document.getElementById('view-limit').innerText = limit;
            document.getElementById('input-new-limit').value = limit;
        }

        function addLimitValue(val) {
            const input = document.getElementById('input-new-limit');
            input.value = parseInt(input.value || 0) + val;
        }

        function updateUserInDB() {
            if(!currentActiveUid) return;
            const newLim = parseInt(document.getElementById('input-new-limit').value);
            
            if(isNaN(newLim)) return alert("Please enter a valid number!");

            db.ref('students/' + currentActiveUid).update({ limit: newLim })
                .then(() => {
                    alert("User Limit Updated!");
                }).catch(err => alert("Error: " + err.message));
        }

        function resetViewsOnly() {
            if(!currentActiveUid || !confirm("Kya aap views zero karna chahte hain?")) return;
            db.ref('students/' + currentActiveUid).update({ views: 0 });
        }

        function filterUsers() {
            const q = document.getElementById('adminSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#admin-user-list tr');
            rows.forEach(r => {
                const text = r.innerText.toLowerCase();
                r.style.display = text.includes(q) ? '' : 'none';
            });
        }

        // Start App
        initAdmin();
    </script>
</body>
</html>
