<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My PDF Vault - SNT Institute</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --primary: #38bdf8; --bg: #0f172a; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg); color: white; margin: 0; padding: 15px; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .pdf-card { background: rgba(30, 41, 59, 0.6); border: 1px solid rgba(255,255,255,0.08); transition: 0.3s; border-radius: 20px; padding: 20px; }
        .btn-view { width: 100%; background: var(--primary); color: #0f172a; font-weight: 800; padding: 12px; border-radius: 12px; margin-top: 15px; }
        #login-overlay { position: fixed; inset: 0; background: #0f172a; z-index: 1000; display: flex; align-items: center; justify-content: center; }
        .limit-reached { border: 2px solid #ef4444 !important; opacity: 0.7; }
    </style>
</head>
<body oncontextmenu="return false;">

    <div id="login-overlay">
        <div class="p-8 glass rounded-3xl text-center max-w-sm mx-4">
            <i class="fas fa-user-shield text-sky-400 text-4xl mb-4"></i>
            <h2 class="text-xl font-bold mb-2">Aap Logged In Nahi Hain</h2>
            <p class="text-slate-400 text-sm mb-6">PDF dekhne ke liye Login zaroori hai.</p>
            <a href="index.html" class="block w-full bg-sky-500 text-slate-900 font-bold py-3 rounded-xl">Login Karein</a>
        </div>
    </div>

    <div id="main-content" class="max-w-4xl mx-auto hidden pb-32">
        <header class="glass p-5 rounded-3xl mb-6 flex flex-col md:flex-row items-center gap-4">
            <img id="user-img" src="./SNT.jpg" class="w-16 h-16 rounded-full border-2 border-sky-500">
            <div class="text-center md:text-left flex-1">
                <h2 id="user-name" class="text-xl font-black italic tracking-tighter">Loading...</h2>
                <div class="flex flex-wrap gap-2 justify-center md:justify-start mt-1">
                    <span id="user-email" class="text-[10px] bg-slate-800 px-2 py-1 rounded border border-white/10 text-slate-300"></span>
                    <span id="user-phone" class="text-[10px] bg-slate-800 px-2 py-1 rounded border border-white/10 text-sky-400"></span>
                </div>
            </div>
            <a href="index.html" class="text-xs font-bold text-red-400 hover:underline">Log Out</a>
        </header>

        <div id="grid" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
    </div>

    <div id="payment-bar" class="fixed bottom-0 left-0 right-0 glass p-4 border-t border-white/10 hidden z-50">
        <div class="max-w-4xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-4">
            <div class="text-center sm:text-left">
                <h4 class="text-red-400 font-bold text-sm">Download Limit Reached! ðŸ›‘</h4>
                <p class="text-[10px] text-slate-300">Aapne 5 PDF dekh li hain. Aur dekhne ke liye niche UPI par â‚¹99 pay karein.</p>
            </div>
            <a href="upi://pay?pa=mandavikaushal913@okaxis&pn=SNT%20Institute&am=99&cu=INR" class="bg-green-500 text-white px-6 py-2 rounded-full font-bold text-sm animate-bounce">
                PAY â‚¹99 VIA UPI
            </a>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAcmK0aCHIgLuFGRPm82GL-hEnLS8JjuKY",
            authDomain: "pdf-reader-650f5.firebaseapp.com",
            databaseURL: "https://pdf-reader-650f5-default-rtdb.firebaseio.com",
            projectId: "pdf-reader-650f5",
            storageBucket: "pdf-reader-650f5.firebasestorage.app",
            messagingSenderId: "163058397387",
            appId: "1:163058397387:web:4cc94d2921706d1bf16b4e"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        let viewCount = localStorage.getItem('pdf_views') || 0;
        let isPaid = false; // Isko aap database se true kar sakte hain payment ke baad

        auth.onAuthStateChanged((user) => {
            if (user) {
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('main-content').classList.remove('hidden');
                
                // Show User Data
                document.getElementById('user-email').innerText = "âœ‰ " + user.email;
                document.getElementById('user-img').src = user.photoURL || "./SNT.jpg";

                db.ref('students/' + user.uid).on('value', (snap) => {
                    const data = snap.val();
                    if(data) {
                        document.getElementById('user-name').innerText = data.name || user.displayName;
                        document.getElementById('user-phone').innerText = "ðŸ“ž " + (data.phone || "No Number");
                        isPaid = data.isPaid || false; // Database mein 'isPaid' check karein
                        loadPDFs();
                    }
                });
            }
        });

        function loadPDFs() {
            db.ref('myPDFs').on('value', (snap) => {
                const grid = document.getElementById('grid');
                grid.innerHTML = '';
                const data = snap.val() || {};
                
                Object.keys(data).reverse().forEach(key => {
                    const pdf = data[key];
                    const div = document.createElement('div');
                    div.className = 'pdf-card';
                    div.innerHTML = `
                        <h3 class="font-bold text-sm mb-1">${pdf.name}</h3>
                        <p class="text-[10px] text-slate-400 mb-3">${pdf.category}</p>
                        <button onclick="handlePDFView('${pdf.pdf}')" class="btn-view">
                            <i class="fas fa-eye mr-2"></i> VIEW NOTES
                        </button>
                    `;
                    grid.appendChild(div);
                });
            });
        }

        function handlePDFView(base64) {
            if (viewCount >= 5 && !isPaid) {
                document.getElementById('payment-bar').classList.remove('hidden');
                alert("Limit khatam! Kripya agle PDFs ke liye payment karein.");
                return;
            }

            // Increment View Count
            if(!isPaid) {
                viewCount++;
                localStorage.setItem('pdf_views', viewCount);
            }

            // View PDF
            const blob = base64ToBlob(base64);
            const url = URL.createObjectURL(blob);
            window.open(url, '_blank');
        }

        function base64ToBlob(base64) {
            const parts = base64.split(';base64,');
            const contentType = parts[0].split(':')[1];
            const raw = window.atob(parts[1]);
            const uInt8Array = new Uint8Array(raw.length);
            for (let i = 0; i < raw.length; ++i) uInt8Array[i] = raw.charCodeAt(i);
            return new Blob([uInt8Array], { type: contentType });
        }
    </script>
</body>
</html>
